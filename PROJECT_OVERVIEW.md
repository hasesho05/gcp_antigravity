# プロジェクト詳細概要: GCP認定資格プラットフォーム (Antigravity)

## 1. プロジェクトの目的と背景

### 1.1. 背景 (The Problem)

GCP（Google Cloud Platform）の認定資格取得を目指す学習者にとって、既存の学習プラットフォーム（Udemy等）や模擬試験サービスには以下の課題が存在します。

*   **コスト:** 複数の試験を受ける場合、教材費が嵩む。
*   **UI/UXの制約:** Webブラウザでの挙動に特化しており、モバイルアプリでの学習体験が最適化されていない場合がある。
*   **分析の弱さ:** 単に正答率が出るだけで、「どの分野（Domain）が弱いか」といった詳細な分析機能が不足していることが多い。

### 1.2. 目的 (The Goal)

「低コストで運用可能かつ、学習効率を最大化する模擬試験プラットフォーム」 を構築します。個人開発としてスタートしますが、将来的なスケーラビリティ（ネイティブアプリ化、サブスクリプション導入）を前提とした堅牢なバックエンドを構築します。

### 1.3. コアバリュー

*   **コスト最適化:** FirestoreのRead/Write回数を極限まで減らす設計により、ランニングコストを最小化する。
*   **中断・再開の自由:** ユーザーはいつでも試験を中断し、別のデバイスからでも同じ箇所から再開できる。
*   **詳細な分析:** 試験結果を「分野（Domain）」ごとに集計し、ユーザーの弱点を可視化する。
*   **拡張性:** クリーンアーキテクチャを採用し、将来の機能追加（Proプラン、モバイルアプリ）に強い構造にする。

## 2. ドメインモデル (Domain Models)

この問題を解決するために定義された、システムの核となるデータ構造です。

### 2.1. User (ユーザーと権限)

アプリケーションの利用者とその権利を管理します。

*   **役割:** 認証、アクセス制御、サブスクリプション管理。
*   **主要フィールド:**
    *   `Role`: `free` (無料), `pro` (有料), `admin` (管理者)
    *   `SubscriptionStatus`: `active`, `expired` 等
*   **ビジネスルール:**
    *   Cloud Digital Leader 試験は全ユーザーが受験可能。
    *   その他の専門資格（PCA, PCD等）は Pro ユーザーのみアクセス可能。

### 2.2. Question (問題データ)

試験の最小単位です。

*   **役割:** 問題文、選択肢、正解、解説の提供。
*   **階層構造:** Certification (資格) > Exam Set (模擬試験セット) > Question (問題)
*   **主要フィールド:**
    *   `ExamID`: 資格ID (例: `professional_cloud_developer`)
    *   `ExamSetID`: セットID (例: `practice_exam_1`)
    *   `QuestionText`: 問題文 (HTML/Rich Text)
    *   `OverallExplanation`: 全体解説 (画像含む)
    *   `Domain`: 出題分野 (例: "Compute", "Security")

### 2.3. Attempt (受験トランザクション)

ユーザーが「ある模擬試験を1回受験した」という履歴と進捗です。

*   **役割:** 回答状況の一時保存、スコアの記録、中断・再開の実現。
*   **主要フィールド:**
    *   `Status`: `in_progress` (実施中), `paused` (中断), `completed` (完了)
    *   `Answers`: `Map<QuestionID, []OptionID>` (ユーザーの回答一覧)
    *   `CurrentIndex`: 現在何問目を解いているか。
*   **コスト対策:** 1問ごとに保存せず、「中断時」または「完了時」のみDBに書き込むことでコストを削減します。

### 2.4. Stats (成績・分析)

ユーザーの長期的な学習成果を集計したデータです。

*   **役割:** ダッシュボード表示、苦手分野の分析。
*   **主要フィールド:**
    *   `DomainStats`: 分野ごとの正答率・回答数。
*   **コスト対策:** 毎回全履歴を集計するのではなく、試験完了時にこのドキュメントを**差分更新（Increment）**します。

## 3. API エンドポイント設計

フロントエンド（React）および将来のネイティブアプリが利用するインターフェースです。RESTfulな設計を採用し、JSONで通信します。

### 3.1. 管理者用 (Admin)

問題データの管理を行います。

| Method | Endpoint                             | Description                     |
| :----- | :----------------------------------- | :------------------------------ |
| POST   | `/admin/exams/{examID}/sets/{setID}/questions` | 問題一括入稿 (Auth: Admin Role Required) |

JSON形式で複数の問題を一度に登録します。

### 3.2. クライアント用 (Client - User)

学習者が利用する機能です。

#### A. 問題取得

| Method | Endpoint                              | Description                                 |
| :----- | :------------------------------------ | :------------------------------------------ |
| GET    | `/exams/{examID}/sets/{setID}/questions` | 問題一覧取得 (指定された模擬試験セット（50問程度）を一括取得します。※コスト削減のため、試験開始時に一度だけ呼び出します。) |

#### B. 受験プロセス (Attempt)

| Method | Endpoint                        | Description                                   |
| :----- | :------------------------------ | :-------------------------------------------- |
| POST   | `/users/me/attempts`            | 試験開始 (新しい受験IDを発行し、開始時刻を記録します。) |
| PUT    | `/users/me/attempts/{attemptID}` | 進捗保存 (中断) (現在の回答状況(answers)と位置(currentIndex)を保存し、ステータスをpausedにします。※または、バックグラウンドでの定期保存に使用します。) |
| POST   | `/users/me/attempts/{attemptID}/complete` | 試験完了・採点 (最終回答を送信し、サーバー側で採点を行います。同時にStatsデータの更新も実行されます。) |

#### C. 分析 (Stats)

| Method | Endpoint                       | Description                                |
| :----- | :----------------------------- | :----------------------------------------- |
| GET    | `/users/me/stats/{examID}`     | 成績参照 (指定した資格（例: PCA）に関する累積スコアと、分野別（Domain別）の正答率データを取得します。) |